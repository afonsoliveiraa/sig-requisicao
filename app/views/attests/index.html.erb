<!-- Container principal -->
<div data-controller="step" data-step-status="<%= @signature.status %>" class="flex items-center justify-center min-h-screen p-4 dark:bg-gray-900">
  <div class="w-full mt-5 max-w-xl p-5 bg-white border border-gray-200 rounded-lg shadow-xs dark:bg-gray-700 dark:border-gray-600">

    <!-- Stepper visual -->
    <ol id="stepper" class="flex items-center justify-center gap-x-6 mb-6 font-normal font-medium text-gray-500">

  <li class="flex items-center">
    <div id="step-item-1" class="flex items-center gap-3">
      <span id="step-bullet-1" data-step-target="bullet1" class="flex items-center justify-center w-8 h-8 rounded-full font-normal font-medium bg-blue-600 text-white">1</span>
      <div class="font-normal font-medium"></div>
    </div>
    <div class="w-24 h-0.5 bg-gray-200 ml-3"></div>  <!-- Linha com largura fixa -->
  </li>

  <li class="flex items-center">
    <div id="step-item-2" class="flex items-center gap-3">
      <span id="step-bullet-2" data-step-target="bullet2" class="flex items-center justify-center w-8 h-8 rounded-full font-normal font-medium bg-gray-200 text-gray-500">2</span>
      <div id="step-label-2" data-step-target="label2" class="font-normal text-gray-500"></div>
    </div>
    <div class="w-24 h-0.5 bg-gray-200 ml-3"></div>  <!-- Linha com largura fixa -->
  </li>

  <li class="flex items-center">
    <div id="step-item-3" class="flex items-center gap-3">
      <span id="step-bullet-3" data-step-target="bullet3" class="flex items-center justify-center w-8 h-8 rounded-full font-normal font-medium bg-gray-200 text-gray-500">3</span>
      <div id="step-label-3" data-step-target="label3" class="font-normal text-gray-500"></div>
    </div>
  </li>

</ol>


    <!-- Step 1: Attest -->
    <div id="step-1" data-step-target="step1" class="space-y-4">
      <div class="relative mb-10">
        <input type="text" value="<%= @attest.system %>" readonly id="system" placeholder=" " class="block px-2.5 pb-2.5 pt-4 w-full font-normal text-gray-900 bg-transparent rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" />
        <label for="system" class="absolute font-normal text-gray-400 dark:text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-700 px-2 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4">Sistema</label>
      </div>

      <div class="relative mb-10">
        <input type="text" value="<%= @attest.entity %>" readonly id="entity" placeholder=" " class="block px-2.5 pb-2.5 pt-4 w-full font-normal text-gray-900 bg-transparent rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" />
        <label for="entity" class="absolute font-normal text-gray-400 dark:text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-700 px-2 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4">Entidade</label>
      </div>

      <div class="relative mb-10">
        <input type="text" value="<%= @attest.operation %>" readonly id="operation" placeholder=" " class="block px-2.5 pb-2.5 pt-4 w-full font-normal text-gray-900 bg-transparent rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" />
        <label for="operation" class="absolute font-normal text-gray-400 dark:text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-700 px-2 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4">Operação</label>
      </div>
      
      <div class="relative mb-10">
        <textarea readonly id="operation" placeholder=" " rows="4"
          class="block px-2.5 pb-2.5 pt-4 w-full font-normal text-gray-900 bg-transparent rounded-lg border border-gray-300 appearance-none resize-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer"><%= @attest.message %></textarea>

        <label for="operation"
          class="absolute font-normal text-gray-400 dark:text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-700 px-2
                peer-focus:text-blue-600 peer-focus:dark:text-blue-500 
                peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-5 
                peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4">
          Observação
        </label>
      </div>

      <div class="flex justify-end">
        <button data-action="click->step#next" type="button" class="w-1/2 text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg font-normal px-5 py-2.5">Próximo</button>
      </div>
    </div>

    <!-- Step 2: Signature -->
    <div id="step-2" data-step-target="step2" class="hidden space-y-4">
      <%= form_with model: @signature, url: update_status_signature_path(@signature), method: :patch, local: true, html: { id: "signature-form", class: "space-y-4 max-w-xl" } do |f| %>
        <div class="relative mb-10">
          <%= f.text_field :title, id: "title", readonly: true, placeholder: " ", class: "block px-2.5 pb-2.5 pt-4 w-full font-normal text-gray-900 bg-transparent rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" %>
          <label for="title" class="absolute font-normal text-gray-400 dark:text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-700 px-2">Título</label>
        </div>

        <div class="relative mb-10">
          <%= f.text_field :name, id: "name", readonly: true, placeholder: " ", class: "block px-2.5 pb-2.5 pt-4 w-full font-normal text-gray-900 bg-transparent rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" %>
          <label for="name" class="absolute font-normal text-gray-400 dark:text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-700 px-2">Nome</label>
        </div>

        <div class="relative mb-10">
          <%= f.text_field :cpf, id: "cpf", readonly: true, placeholder: " ", class: "block px-2.5 pb-2.5 pt-4 w-full font-normal text-gray-900 bg-transparent rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" %>
          <label for="cpf" class="absolute font-normal text-gray-400 dark:text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-700 px-2">CPF</label>
        </div>

        <div class="relative mb-10">
          <%= f.email_field :email, id: "email", readonly: true, placeholder: " ", class: "block px-2.5 pb-2.5 pt-4 w-full font-normal text-gray-900 bg-transparent rounded-lg border border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" %>
          <label for="email" class="absolute font-normal text-gray-400 dark:text-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white dark:bg-gray-700 px-2">Email</label>
        </div>

        <div class="flex gap-4">
          <button data-action="click->step#back" type="button" class="w-1/2 text-gray-700 bg-gray-200 hover:bg-gray-300 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg font-normal px-5 py-2.5">Voltar</button>
          <button type="button" data-modal-target="confirm-modal" data-modal-toggle="confirm-modal" id="btn-open-confirm" class="w-1/2 text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg font-normal px-5 py-2.5" <%= 'disabled="disabled"' if @signature.status == 'CONFIRMADO' %>>Assinar</button>
        </div>
      <% end %>
    </div>

    <!-- Step 3: Confirmação -->
    <div id="step-3" data-step-target="step3" class="hidden flex flex-col items-center justify-center space-y-4 text-center">
      <% if @signature.status == 'CONFIRMADO' %>
        <div class="mt-5">
          <lottie-player src="https://assets3.lottiefiles.com/packages/lf20_jbrw3hcz.json" background="transparent" speed="1" style="width: 500px; height: 500px;" autoplay></lottie-player>
          <p class="text-green-600">Assinatura confirmada em <%= l(@signature.signed_at, format: :short) %></p>
        </div>
      <% else %>
        <p class="text-gray-700">Aqui você pode colocar informações de confirmação ou próximas ações.</p>
      <% end %>
    </div>

  </div>
</div>

<!-- Modal de confirmação -->
<div id="confirm-modal" tabindex="-1" aria-hidden="true" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full p-6 relative">
    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Confirmar Assinatura</h3>
    <p class="text-gray-700 dark:text-gray-300 mb-6">Você tem certeza que deseja confirmar a assinatura?</p>

    <div class="flex justify-end gap-4">
      <button type="button" data-modal-toggle="confirm-modal" class="px-4 py-2 rounded-lg bg-gray-300 hover:bg-gray-400 text-gray-700 dark:text-gray-800 dark:bg-gray-600 dark:hover:bg-gray-700">Cancelar</button>

      <%= button_to update_status_signature_path(@signature), method: :patch, form: { id: 'confirm-sign-form' }, class: "px-4 py-2 rounded-lg bg-blue-700 hover:bg-blue-800 text-white" do %>
        Confirmar
      <% end %>
    </div>

  </div>
</div>

<%= render partial: 'shared/footer' %>
